image: node:latest

stages:
  - deploy

deploy:
  stage: deploy
  script:
    - git fetch && git symbolic-ref -q HEAD > /dev/null || (git branch -d ${CI_COMMIT_REF_NAME} || true && git checkout -b ${CI_COMMIT_REF_NAME} && git branch --set-upstream-to=origin/${CI_COMMIT_REF_NAME} ${CI_COMMIT_REF_NAME})
    - yarn install --immutable --immutable-cache
    - yarn build
#    - ./node_modules/lerna/cli.js bootstrap --use-workspaces
    - ./node_modules/lerna/cli.js version patch
    - ./node_modules/lerna/cli.js publish from-package
